var current_text="",current_sort="n",current_order="d",current_ways="search",domain="http://www.nicovideo.jp/",ways="search",sort="n",order="d";try{$(document).ready(function(){$("#jsddm > li").bind("mouseover",jsddm_open);$("#jsddm > li").bind("mouseout",jsddm_timer);$("#loading").hide();setLocaleWording();changeSearchDisplay()})}catch(e$$5){console.error("Iinitailize: "+e$$5)} function setLocaleWording(){try{var zx='';zx==""&&($("#open2tab").html(chrome.i18n.getMessage("open2tab")),$("#result_text").html(chrome.i18n.getMessage("result_text")),$("#loading").append('<span style="color:red;">'+chrome.i18n.getMessage("loading")+"</span>"),$("#jsddm_span").html(chrome.i18n.getMessage("popular_tag")),$("#kw").html(chrome.i18n.getMessage("kw")),$("#tag").html(chrome.i18n.getMessage("tag")),$("#new_comment").html(chrome.i18n.getMessage("new_comment")),$("#old_comment").html(chrome.i18n.getMessage("old_comment")), $("#most_play").html(chrome.i18n.getMessage("most_play")),$("#lest_play").html(chrome.i18n.getMessage("lest_play")),$("#most_comment").html(chrome.i18n.getMessage("most_comment")),$("#lest_comment").html(chrome.i18n.getMessage("lest_comment")),$("#new_update").html(chrome.i18n.getMessage("new_update")),$("#old_update").html(chrome.i18n.getMessage("old_update")),$("#most_mylist").html(chrome.i18n.getMessage("most_mylist")),$("#lest_mylist").html(chrome.i18n.getMessage("lest_mylist")),$("#long_vtime").html(chrome.i18n.getMessage("long_vtime")), $("#short_vtime").html(chrome.i18n.getMessage("short_vtime")))}catch(a){alert(a),console.error("setLocaleWording: "+a)}} function changeSearch(a){try{switch(a){case "kw":$("#kw").attr("selectd","on");$("#tag").attr("selectd","off");ways="search";break;case "tag":$("#kw").attr("selectd","off");$("#tag").attr("selectd","on");ways="tag";break;case "mylist":$("#kw").attr("selectd","off");$("#tag").attr("selectd","off");ways="mylist_search";break;default:$("#kw").attr("selectd","on"),$("#tag").attr("selectd","off"),ways="search"}changeSearchDisplay()}catch(b){console.error(b)}}var list=["kw","tag"]; function changeSearchDisplay(){try{$("#kw").css({backgroundColor:"#333",color:"white"});for(var a in list)$("#"+list[a]+"").attr("selectd")=="on"?$("#"+list[a]+"").css({backgroundColor:"#333",color:"white"}):$("#"+list[a]+"").css({backgroundColor:"#D0D0FF",color:"black"})}catch(b){console.error(b)}} function getInputText(a){try{$("#opt_list option:selected").attr("value");var b=$("#opt_list option:selected").attr("sort"),c=$("#opt_list option:selected").attr("order");a==""||a==current_text&&b==current_sort&&c==current_order&&ways==current_ways||($("#loading").show(),current_text=a,current_sort=b,current_order=c,current_ways=ways,nico_search(a));var e=$("#search").val();window.setTimeout("getInputText('"+e+"');",1500)}catch(d){console.error(d)}} function nico_search(a){a="http://www.nicovideo.jp/"+current_ways+"/"+a+"?sort="+current_sort+"&order="+current_order;console.log(a);var b=new XMLHttpRequest,c,e,d,g,h,i;b.onreadystatechange=function(){if(b.readyState==4&&b.status==200)try{c=b.responseText;$("#result_table > tbody tr").remove();d=c.match(/<a (.+)<img src=\"(.+)\" alt=\"\" class=\"img_std96\"\><\/a\>/g);e=c.match(/<a href\=\"watch\/([a-zA-Z]{2}\d+)\" class\=\"watch\" title\=\".+\"\>.+\<\/a\>/g);g=c.match(/<p class\=\"vinfo_length\"><span>(.+)<\/span><\/p>/g); h=c.match(/<strong class\=\"vinfo_view\">(.+)<\/strong>/g);i=c.match(/<strong class\=\"vinfo_res\">(.+)<\/strong>/g);var a,j,k,l,m,f;for(f in e)a=e[f].replace("watch","http://www.nicovideo.jp/watch"),j=d[f].replace("watch","http://www.nicovideo.jp/watch"),k=g[f].match(/<span>(.+)<\/span>/i)[1],l=h[f].match(/<strong class\=\"vinfo_view\">(.+)<\/strong>/i)[1],m=i[f].match(/<strong class\=\"vinfo_res\">(.+)<\/strong>/i)[1],$("#result_table > tbody:last").append("<tr><td><p>"+j+'</p><p id="video_length">'+ k+"</p></td><td>"+a+"<br />"+chrome.i18n.getMessage("play_count")+": "+l+"<br />"+chrome.i18n.getMessage("comment_count")+": "+m+"</td></tr>");$("#result_table a").each(function(){$(this).attr("href");$(this).attr("target","_blank")});$("#loading").hide()}catch(n){console.error(n)}};b.open("GET",a,!0);b.send()}function openURL(a){a=="popup"&&(a=chrome.extension.getURL("popup.html"));chrome.tabs.create({url:a},function(){})}function fillIn(a){$("#search").val(a)} function getTagRanking(){try{var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState==4&&a.status==200){var b=a.responseText.match(/<a rel=\"tag\" class=\"level\_[1-4]{1}\"(.+)\<\/a\>/g);b.sort(function(){return Math.round(Math.random())});for(var e=1;e<=15;e++){var d=b.pop(),g=d.match(/\>(.+)\<\/a\>/i)[1],d=d.replace('href="tag',"onclick=\"fillIn('"+g+'\')" href="http://www.nicovideo.jp/tag');$("#jsddm li ul:last").prepend("<li>"+d+"</li>")}$("#jsddmli ul li a").attr("href","#"); $("#jsddm li ul:last").append('<li id="more"><a href="http://www.nicovideo.jp/major_tag" target="_blank">\u67e5\u770b\u66f4\u591a...</a></li>')}};a.open("GET","http://www.nicovideo.jp/major_tag",!0);a.send()}catch(b){console.error("getTagRanking: "+b)}}function getCookies(a,b,c){chrome.cookies.get({url:a,name:b},function(a){c&&c(a.value)})}function refreshTag(){$("#jsddm_span").click(function(){$("#jsddmli ul li").remove();getTagRanking()})} function gettingStart(){try{chrome.tabs.getSelected(null,function(){}),refreshTag(),getTagRanking(),getInputText("")}catch(a){console.error(a)}}var timeout=100,closetimer=0,ddmenuitem=0;function jsddm_open(){jsddm_canceltimer();jsddm_close();ddmenuitem=$(this).find("ul").eq(0).css("visibility","visible")}function jsddm_close(){ddmenuitem&&ddmenuitem.css("visibility","hidden")}function jsddm_timer(){closetimer=window.setTimeout(jsddm_close,timeout)} function jsddm_canceltimer(){closetimer&&(window.clearTimeout(closetimer),closetimer=null)};